# ××‘× ×” ×”×‘×•×˜ - ×ª×¨×©×™× ×˜×›× ×™ ğŸ—ï¸

## ××¨×›×™×˜×§×˜×•×¨×” ×›×œ×œ×™×ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telegram User  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   bot.py (Main Bot)    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Command Handlers â”‚  â”‚
â”‚  â”‚ Callback Handlersâ”‚  â”‚
â”‚  â”‚ Conversations    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   database.py     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MongoDB    â”‚  â”‚
â”‚  â”‚  Operations â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MongoDB Atlas  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  users    â”‚  â”‚
â”‚  â”‚  items    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ×§×‘×¦×™ ×”×¤×¨×•×™×§×˜

### 1. `bot.py` - ×”×œ×‘ ×©×œ ×”×‘×•×˜ ğŸ’š
**×ª×¤×§×™×“:** × ×™×”×•×œ ×›×œ ×”×ª×§×©×•×¨×ª ×¢× ×˜×œ×’×¨×

**Components:**
```python
â”œâ”€â”€ Command Handlers
â”‚   â”œâ”€â”€ /start
â”‚   â”œâ”€â”€ /help
â”‚   â”œâ”€â”€ /add
â”‚   â””â”€â”€ /cancel
â”‚
â”œâ”€â”€ Conversation Handlers
â”‚   â”œâ”€â”€ Add Item Flow (×”×•×¡×¤×ª ×¤×¨×™×˜)
â”‚   â”‚   â”œâ”€â”€ ADD_CONTENT (×§×‘×œ×ª ×ª×•×›×Ÿ)
â”‚   â”‚   â”œâ”€â”€ ADD_REMINDER (×‘×—×™×¨×ª ×ª×–×›×•×¨×ª)
â”‚   â”‚   â””â”€â”€ CUSTOM_DATE (×ª××¨×™×š ××•×ª××)
â”‚   â”‚
â”‚   â”œâ”€â”€ Search Flow (×—×™×¤×•×©)
â”‚   â”‚   â””â”€â”€ SEARCH_QUERY (×§×‘×œ×ª ×©××™×œ×ª×”)
â”‚   â”‚
â”‚   â””â”€â”€ Edit Flow (×¢×¨×™×›×”)
â”‚       â””â”€â”€ EDIT_CONTENT (×ª×•×›×Ÿ ×—×“×©)
â”‚
â”œâ”€â”€ Callback Query Handlers
â”‚   â”œâ”€â”€ Item Actions (×¤×¢×•×œ×•×ª ×¢×œ ×¤×¨×™×˜)
â”‚   â”œâ”€â”€ Review Actions (×¤×¢×•×œ×•×ª ×‘×¡×™×§×•×¨)
â”‚   â””â”€â”€ Reminder Selection
â”‚
â””â”€â”€ Utilities
    â”œâ”€â”€ check_reminders_and_review()
    â”œâ”€â”€ get_item_keyboard()
    â””â”€â”€ show_review_item()
```

### 2. `database.py` - ×©×›×‘×ª ×”×“××˜×” ğŸ—„ï¸
**×ª×¤×§×™×“:** ×›×œ ×”×¤×¢×•×œ×•×ª ××•×œ MongoDB

**Functions:**
```python
â”œâ”€â”€ User Management
â”‚   â”œâ”€â”€ get_or_create_user()
â”‚   â”œâ”€â”€ update_last_review()
â”‚   â””â”€â”€ should_review()
â”‚
â”œâ”€â”€ Item CRUD
â”‚   â”œâ”€â”€ add_item()
â”‚   â”œâ”€â”€ get_item_by_id()
â”‚   â”œâ”€â”€ update_item_status()
â”‚   â””â”€â”€ update_item_content()
â”‚
â”œâ”€â”€ Item Queries
â”‚   â”œâ”€â”€ get_items_today()
â”‚   â”œâ”€â”€ get_items_week()
â”‚   â”œâ”€â”€ get_archived_items()
â”‚   â”œâ”€â”€ search_items()
â”‚   â””â”€â”€ get_items_for_review()
â”‚
â”œâ”€â”€ Reminder Operations
â”‚   â”œâ”€â”€ set_reminder()
â”‚   â”œâ”€â”€ get_pending_reminders()
â”‚   â””â”€â”€ mark_reminder_sent()
â”‚
â””â”€â”€ Review Operations
    â””â”€â”€ keep_for_next_week()
```

### 3. `utils.py` - ×›×œ×™ ×¢×–×¨ ğŸ› ï¸
**×ª×¤×§×™×“:** ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×¢×™×‘×•×“ ×•× ×™×”×•×œ

**Functions:**
```python
â”œâ”€â”€ Text Processing
â”‚   â””â”€â”€ extract_tags()           # ×—×™×œ×•×¥ #×ª×’×™×•×ª ××˜×§×¡×˜
â”‚
â”œâ”€â”€ Formatting
â”‚   â”œâ”€â”€ format_item()            # ×¢×™×¦×•×‘ ×¤×¨×™×˜ ×‘×•×“×“
â”‚   â””â”€â”€ format_items_list()      # ×¢×™×¦×•×‘ ×¨×©×™××ª ×¤×¨×™×˜×™×
â”‚
â”œâ”€â”€ Date Handling
â”‚   â”œâ”€â”€ get_reminder_date()      # ×”××¨×ª ××•×¤×¦×™×” ×œ×ª××¨×™×š
â”‚   â”œâ”€â”€ format_reminder_option() # ×¢×™×¦×•×‘ ×˜×§×¡×˜ ×›×¤×ª×•×¨
â”‚   â””â”€â”€ validate_date_input()    # ×•×•×œ×™×“×¦×™×” ×œ×ª××¨×™×š
```

## ××‘× ×” ×”-Database ğŸ—ƒï¸

### Collection: `users`
```javascript
{
  _id: ObjectId,
  user_id: Number,          // Telegram User ID
  last_review_date: Date,   // ×ª××¨×™×š ×¡×™×§×•×¨ ××—×¨×•×Ÿ
  created_at: Date
}
```

### Collection: `items`
```javascript
{
  _id: ObjectId,
  user_id: Number,          // ×©×œ ××™ ×”×¤×¨×™×˜
  type: String,             // "thought" / "task"
  content: String,          // ×”×ª×•×›×Ÿ
  tags: [String],           // ××¢×¨×š ×ª×’×™×•×ª
  status: String,           // "active" / "archived" / "deleted"
  created_at: Date,         // ××ª×™ × ×•×¦×¨
  keep_until: Date,         // null ××• ×ª××¨×™×š ×¢×ª×™×“×™
  reminder_date: Date,      // null ××• ×ª××¨×™×š ×ª×–×›×•×¨×ª
  reminded: Boolean         // ×”×× ×ª×–×›×•×¨×ª × ×©×œ×—×”
}
```

## ×ª×”×œ×™×›×™× ×¢×™×§×¨×™×™× ğŸ”„

### 1. ×”×•×¡×¤×ª ×¤×¨×™×˜
```
User â†’ /add
  â†“
Bot â†’ ×‘×§×© ×ª×•×›×Ÿ
  â†“
User â†’ ×©×•×œ×— ×˜×§×¡×˜ + #×ª×’×™×•×ª
  â†“
utils.extract_tags() â†’ ××¤×¨×™×“ ×ª×•×›×Ÿ ×•×ª×’×™×•×ª
  â†“
Bot â†’ ×‘×§×© ×¡×•×’ (××—×©×‘×”/××©×™××”)
  â†“
User â†’ ×‘×•×—×¨ ×¡×•×’
  â†“
Bot â†’ ×”×¦×¢ ×ª×–×›×•×¨×•×ª
  â†“
User â†’ ×‘×•×—×¨ ×ª×–×›×•×¨×ª ××• "×œ×œ×"
  â†“
database.add_item() â†’ ×©××™×¨×” ×‘-MongoDB
  â†“
Bot â†’ ××™×©×•×¨ + ×”×¦×’×ª ×”×¤×¨×™×˜
```

### 2. ×¡×™×§×•×¨ ×©×‘×•×¢×™
```
User â†’ ×¤×•×ª×— ××ª ×”×‘×•×˜
  â†“
check_reminders_and_review()
  â†“
database.should_review(user_id)
  â†“
×× ×¢×‘×¨ ×©×‘×•×¢:
  â†“
Bot â†’ "×¨×•×¦×” ×œ×¢×©×•×ª ×¡×™×§×•×¨?"
  â†“
User â†’ ×œ×•×—×¥ "×‘×•× × ×ª×—×™×œ"
  â†“
database.get_items_for_review()
  â†“
×¢×‘×•×¨ ×›×œ ×¤×¨×™×˜:
  â”œâ”€â†’ Bot â†’ ××¦×™×’ + 3 ××¤×©×¨×•×™×•×ª
  â”œâ”€â†’ User â†’ ×‘×•×—×¨ ×¤×¢×•×œ×”
  â””â”€â†’ database.update...()
  â†“
Bot â†’ ×¡×™×›×•× + ×¢×“×›×•×Ÿ last_review_date
```

### 3. ×ª×–×›×•×¨×•×ª
```
User â†’ ×¤×•×ª×— ××ª ×”×‘×•×˜
  â†“
check_reminders_and_review()
  â†“
database.get_pending_reminders(user_id)
  â†“
×¢×‘×•×¨ ×›×œ ×ª×–×›×•×¨×ª:
  â”œâ”€â†’ Bot â†’ "ğŸ”” ×ª×–×›×•×¨×ª!" + ×”×¤×¨×™×˜
  â””â”€â†’ database.mark_reminder_sent()
```

## Flow ×©×œ Conversations ğŸ’¬

### Add Item Conversation
```
State: START
  â†“
[/add ××• â• ×”×•×¡×£]
  â†“
State: ADD_CONTENT
  â†“
[×§×‘×œ×ª ×˜×§×¡×˜]
  â†“
State: ADD_REMINDER (callback)
  â†“
[×‘×—×™×¨×ª ×¡×•×’: thought/task]
  â†“
[×‘×—×™×¨×ª ×ª×–×›×•×¨×ª]
  â†“
×× "×ª××¨×™×š ××“×•×™×§":
  State: CUSTOM_DATE
  â†“
END
```

## ×ª×¤×¨×™×˜ ×”×‘×•×˜ ğŸ›ï¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Main Keyboard         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â• ×”×•×¡×£  â”‚  ğŸ“… ×”×™×•×   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“† ×”×©×‘×•×¢ â”‚  ğŸ“¦ ××¨×›×™×•×Ÿ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” ×—×™×¤×•×© â”‚  ğŸ“‹ ×¡×™×§×•×¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Inline Keyboards:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Item Actions          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœï¸ ×¢×¨×•×š â”‚ ğŸ“¦ ××¨×›×™×•×Ÿ â”‚ ğŸ—‘ï¸ ××—×§ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Review Actions        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ğŸ“¦ ×œ××¨×›×™×•×Ÿ          â”‚
â”‚  â™»ï¸ ×©××•×¨ ×œ×©×‘×•×¢ ×”×‘×      â”‚
â”‚       ğŸ—‘ï¸ ××—×§            â”‚
â”‚       â­ï¸ ×“×œ×’             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Dependencies ğŸ“¦

```
python-telegram-bot==20.7  â†’ Framework ×œ×˜×œ×’×¨×
pymongo==4.6.1             â†’ MongoDB Driver
python-dotenv==1.0.0       â†’ × ×™×”×•×œ ××©×ª× ×™ ×¡×‘×™×‘×”
dnspython==2.4.2           â†’ × ×“×¨×© ×œ-MongoDB Atlas
```

## Environment Variables ğŸ”

```env
TELEGRAM_TOKEN=...  â†’ Token ×-@BotFather
MONGODB_URI=...     â†’ Connection String ×-Atlas
```

## Deployment ×¢×œ Render ğŸš€

```yaml
render.yaml:
  - type: web
  - env: python
  - buildCommand: pip install -r requirements.txt
  - startCommand: python bot.py
```

**×—×©×•×‘:** ×”×¤×œ××Ÿ ×¦×¨×™×š ×œ×”×™×•×ª ×‘×ª×©×œ×•× ×›×“×™ ×©×”×‘×•×˜ ×œ× ×™×¨×“×!

## ×˜×™×¤×™× ×œ×¤×™×ª×•×— × ×•×¡×£ ğŸ’¡

### ×”×•×¡×¤×ª ×¤×™×¦'×¨ ×—×“×©:
1. ×”×•×¡×£ handler ×‘-`bot.py`
2. ×”×•×¡×£ DB function ×‘-`database.py` (×× ×¦×¨×™×š)
3. ×”×•×¡×£ ×¢×™×¦×•×‘/×œ×•×’×™×§×” ×‘-`utils.py` (×× ×¦×¨×™×š)
4. ×¢×“×›×Ÿ README

### ×“×™×‘××’:
```python
# ×”×•×¡×£ ×‘×¨××© bot.py:
logging.basicConfig(level=logging.DEBUG)

# ××• ×¦×¤×” ×‘-logs ×‘-Render Dashboard
```

### ×˜×¡×˜×™×:
```bash
# ×‘×“×™×§×” ××§×•××™×ª ×œ×¤× ×™ ×”×¢×œ××”
python bot.py

# ×‘×“×•×§:
- ×”×ª×—×‘×¨×•×ª ×œ-MongoDB
- ×›×œ ×”×¤×§×•×“×•×ª ×¢×•×‘×“×•×ª
- Callbacks ××’×™×‘×™×
```

---

**×¡×™×›×•× ××”×™×¨:**
- `bot.py` = ×××©×§ + ×œ×•×’×™×§×ª ×©×™×—×”
- `database.py` = ×›×œ ××” ×©×§×©×•×¨ ×œ×“××˜×”
- `utils.py` = ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×§×˜× ×•×ª
- MongoDB = ××—×¡×•×Ÿ × ×ª×•× ×™×
- Render = ×”×•×¡×˜×™× ×’

ğŸ‰ ×‘×”×¦×œ×—×”!
